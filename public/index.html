<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<canvas id="audio_canvas"></canvas>
	<script>
		var AudioContext = window.AudioContext || window.webkitAudioContext
		// 音频上下文环境
		var audioCtx = new AudioContext()
		try {
			var source = audioCtx.createBufferSource()
			// 控制音量
			var gain = audioCtx.createGain()
			// 分析器
			var analyse = audioCtx.createAnalyser()

			var request = new XMLHttpRequest()

			 //初始化 HTTP 请求参数, 配置请求类型，文件路径等
			 request.open('GET', 'demo.mp3', true)

			 // 配置数据返回类型,从服务器取回二进制数据
			 request.responseType = 'arraybuffer'

			 // 发送ajax
			 request.send()

			 // 获取完成，对音频进一步操作，解码
			 request.onload = function() {
			 	var audioData = request.response
			 	// 解码音频，分析音频
			 	audioCtx.decodeAudioData(audioData,
			 		function(buffer) {
			 			// 设置音频数据
			 			source.buffer = buffer
			 			// 连接分析器
			 			source.connect(analyse)
			 			// 连接到设备的, 类似于pipe
			 			// 扬声器
			 			analyse.connect(audioCtx.destination)
			 			analyse.fftSize = 2048

			 			var arr = new Uint8Array(analyse.frequencyBinCount)

			 			setInterval(function() {
			 				analyse.getByteFrequencyData(arr)
			 				// ok了
			 				console.log(arr)
			 			}, 1000)
			 		},
				 	function(e) {
				 		console.log("Error with decoding audio data" + e.err)
				 	}
			 	)
			 }
		} catch (err) {
			alert('Your browser does not support AudioContext!')
			console.log(err)
		}
	</script>
</body>
</html>